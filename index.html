<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setup Match</title>
<style>
body{font-family:sans-serif;padding:20px}
button{margin:4px;padding:6px 10px}
.selected{background:#22c55e;color:white}
</style>
</head>
<body>

<h2>Tournoi</h2>

<input id="tournamentId" placeholder="Tournament ID">
<input id="phase" placeholder="Phase">
<input id="matchNumber" placeholder="Match">
<input id="station" placeholder="Station A/B">
<button onclick="saveContext()">Valider contexte</button>

<hr>

<h2>Sélection des joueurs (3 max)</h2>

<div id="playerList"></div>

<p>Selection : <strong><span id="count">0</span>/3</strong></p>

<ul id="selectedList"></ul>

<button id="confirmBtn" disabled onclick="confirmTeam()">
Démarrer le match
</button>

<script>

// --- Registre permanent ---
let PLAYERS = JSON.parse(localStorage.getItem("players_registry")) || [
 {id:"P1",full_name:"Pablo Quenum",display_name:""},
 {id:"P2",full_name:"Leo Martin",display_name:""},
 {id:"P3",full_name:"Nico Durand",display_name:""},
 {id:"P4",full_name:"Sam Lopez",display_name:""},
 {id:"P5",full_name:"Tom Leroy",display_name:""}
];

let selected=[];

function getDisplayName(p){
 return p.display_name?.trim()?p.display_name:p.full_name;
}

function saveContext(){
 localStorage.setItem("tournament_id",
  document.getElementById("tournamentId").value);
 localStorage.setItem("phase",
  document.getElementById("phase").value);
 localStorage.setItem("match_number",
  document.getElementById("matchNumber").value);
 localStorage.setItem("station_id",
  document.getElementById("station").value);
}

function renderPlayers(){
 const container=document.getElementById("playerList");
 container.innerHTML="";
 PLAYERS.forEach(p=>{
  const btn=document.createElement("button");
  btn.textContent=getDisplayName(p);
  btn.onclick=()=>togglePlayer(p,btn);
  container.appendChild(btn);
 });
}

function togglePlayer(player,button){
 const index=selected.findIndex(p=>p.id===player.id);

 if(index>-1){
  selected.splice(index,1);
  button.classList.remove("selected");
 }else{
  if(selected.length>=3){
   alert("Maximum 3 joueurs");
   return;
  }
  selected.push(player);
  button.classList.add("selected");
 }

 updateUI();
}

function updateUI(){
 document.getElementById("count").textContent=selected.length;

 const list=document.getElementById("selectedList");
 list.innerHTML="";
 selected.forEach(p=>{
  const li=document.createElement("li");
  li.textContent=getDisplayName(p);
  list.appendChild(li);
 });

 document.getElementById("confirmBtn").disabled=selected.length!==3;
}

function confirmTeam(){
 localStorage.setItem("current_team",JSON.stringify(selected));
 window.location.href="match.html";
}

renderPlayers();

</script>
</body>
</html>