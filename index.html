<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Station Stats V4</title>

<style>
:root {
    --bg: #f4f6f9;
    --card: #ffffff;
    --border: #e0e4ea;
    --offense: #ffe9d6;
    --defense: #d9ecff;
    --discipline: #ffdcdc;
    --special: #eadcff;
    --accent: #1f2937;
}

body {
    margin: 0;
    font-family: "Segoe UI", Roboto, sans-serif;
    background: var(--bg);
}

/* HEADER */
.header {
    background: var(--accent);
    color: white;
    padding: 14px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 500;
}

.header button {
    background: white;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
}

.header button:hover {
    opacity: 0.9;
}

/* GRID */
.grid {
    display: grid;
    grid-template-columns: 160px repeat(3, 1fr);
    gap: 8px;
    padding: 16px;
}

.player-header {
    text-align: center;
    font-weight: 700;
    background: var(--card);
    padding: 14px;
    border-radius: 8px;
    border: 1px solid var(--border);
}

/* CATEGORY STRIP */
.category {
    grid-column: span 4;
    padding: 8px 12px;
    font-weight: 700;
    border-radius: 6px;
    margin-top: 10px;
}

.offense { background: var(--offense); }
.defense { background: var(--defense); }
.discipline { background: var(--discipline); }
.special { background: var(--special); }

.criterion {
    font-weight: 600;
    background: var(--card);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
}

/* CELLS */
.cell {
    background: var(--card);
    border-radius: 10px;
    border: 1px solid var(--border);
    cursor: pointer;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 600;
    transition: 0.1s;
    min-height: 70px;
}

.cell.main {
    min-height: 100px;
    font-size: 18px;
}

.cell:hover {
    transform: scale(1.03);
}

.cell.flash {
    background: #22c55e !important;
    color: white;
    transform: scale(0.97);
}

.counter {
    position: absolute;
    bottom: 6px;
    right: 10px;
    font-size: 13px;
    opacity: 0.6;
}

/* RESPONSIVE */
@media (max-width: 900px) {
    .grid {
        grid-template-columns: 120px repeat(3, 1fr);
    }
}
</style>
</head>

<body>

<div class="header">
    <div>Match Prototype</div>
    <div>
        <button onclick="exportCSV()">Export</button>
        <button onclick="resetData()">Reset</button>
    </div>
</div>

<div class="grid">

    <div></div>
    <div class="player-header">J1</div>
    <div class="player-header">J2</div>
    <div class="player-header">J3</div>

    <!-- OFFENSE -->
    <div class="category offense">OFFENSE</div>

    <div class="criterion">SHOT</div>
    <div class="cell main" onclick="addEvent('J1','SHOT',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J2','SHOT',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J3','SHOT',this)"><span class="counter">0</span></div>

    <div class="criterion">ASSIST</div>
    <div class="cell main" onclick="addEvent('J1','ASSIST',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J2','ASSIST',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J3','ASSIST',this)"><span class="counter">0</span></div>

    <div class="criterion">GOAL</div>
    <div class="cell" onclick="addEvent('J1','GOAL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J2','GOAL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J3','GOAL',this)"><span class="counter">0</span></div>

    <!-- DEFENSE -->
    <div class="category defense">DEFENSE</div>

    <div class="criterion">SAVE</div>
    <div class="cell main" onclick="addEvent('J1','SAVE',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J2','SAVE',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J3','SAVE',this)"><span class="counter">0</span></div>

    <div class="criterion">RECOVERY</div>
    <div class="cell main" onclick="addEvent('J1','RECOVERY',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J2','RECOVERY',this)"><span class="counter">0</span></div>
    <div class="cell main" onclick="addEvent('J3','RECOVERY',this)"><span class="counter">0</span></div>

    <!-- DISCIPLINE -->
    <div class="category discipline">DISCIPLINE</div>

    <div class="criterion">FOUL</div>
    <div class="cell" onclick="addEvent('J1','FOUL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J2','FOUL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J3','FOUL',this)"><span class="counter">0</span></div>

    <!-- SPECIAL -->
    <div class="category special">SPECIAL</div>

    <div class="criterion">OWN_GOAL</div>
    <div class="cell" onclick="addEvent('J1','OWN_GOAL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J2','OWN_GOAL',this)"><span class="counter">0</span></div>
    <div class="cell" onclick="addEvent('J3','OWN_GOAL',this)"><span class="counter">0</span></div>

</div>

<script>
let log = [];

// ðŸ”µ RÃˆGLES MÃ‰TIER CENTRALISÃ‰ES
const RULES = {
    GOAL: ["SHOT"]
};

// ðŸ”µ FONCTION PRINCIPALE
function addEvent(player, critere, element) {

    // 1ï¸âƒ£ Ajouter lâ€™Ã©vÃ©nement principal
    processEvent(player, critere, element);

    // 2ï¸âƒ£ VÃ©rifier sâ€™il existe des rÃ¨gles associÃ©es
    if (RULES[critere]) {
        RULES[critere].forEach(dependentCritere => {

            // Trouver la cellule correspondante Ã  lâ€™Ã©cran
            let targetCell = findCell(player, dependentCritere);

            processEvent(player, dependentCritere, targetCell);
        });
    }
}


// ðŸ”µ AJOUT + INCRÃ‰MENT
function processEvent(player, critere, element) {

    log.push({
        date: new Date().toISOString(),
        match_id: "PROTOTYPE",
        equipe: "A",
        joueur: player,
        critere: critere
    });

    if (element) {
        let counter = element.querySelector(".counter");
        counter.textContent = parseInt(counter.textContent) + 1;

        element.classList.add("flash");
        setTimeout(() => element.classList.remove("flash"), 120);
    }
}


// ðŸ”µ TROUVER LA CELLULE CORRESPONDANTE
function findCell(player, critere) {

    let criteriaLabels = document.querySelectorAll(".criterion");

    for (let label of criteriaLabels) {

        if (label.textContent.trim() === critere) {

            let next = label.nextElementSibling;
            let cells = [];

            for (let i = 0; i < 3; i++) {
                cells.push(next);
                next = next.nextElementSibling;
            }

            let playerIndex = ["J1","J2","J3"].indexOf(player);
            return cells[playerIndex];
        }
    }

    return null;
}

function exportCSV() {
    let csv = "date,match_id,equipe,joueur,critere\n";
    log.forEach(e => {
        csv += `${e.date},${e.match_id},${e.equipe},${e.joueur},${e.critere}\n`;
    });

    let blob = new Blob([csv], { type: 'text/csv' });
    let url = URL.createObjectURL(blob);
    let a = document.createElement('a');
    a.href = url;
    a.download = "match_export.csv";
    a.click();
}

function resetData() {
    log = [];
    document.querySelectorAll(".counter").forEach(c => c.textContent = "0");
}
</script>

</body>
</html>



