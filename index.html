<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setup Match</title>
<style>
:root{
 --bg:#f4f6f9;
 --card:#ffffff;
 --accent:#1f2937;
 --primary:#2563eb;
 --success:#22c55e;
}

body{
 margin:0;
 font-family:Segoe UI,sans-serif;
 background:var(--bg);
 padding:20px;
}

h2{
 margin-top:0;
}

.section{
 background:var(--card);
 padding:20px;
 border-radius:12px;
 box-shadow:0 4px 10px rgba(0,0,0,0.05);
 margin-bottom:20px;
}

label{
 display:block;
 margin-top:10px;
 font-weight:600;
}

input,select{
 width:100%;
 padding:8px;
 margin-top:4px;
 border-radius:6px;
 border:1px solid #ddd;
 box-sizing:border-box;
}

button{
 margin-top:12px;
 padding:8px 12px;
 border:none;
 border-radius:8px;
 cursor:pointer;
 font-weight:600;
}

.primary{
 background:var(--primary);
 color:white;
}

.selected{
 background:var(--success);
 color:white;
}

.player-buttons{
 display:flex;
 flex-wrap:wrap;
 gap:8px;
 margin-top:10px;
}

.player-buttons button{
 background:#e5e7eb;
}

.counter{
 font-weight:700;
 margin-top:10px;
}

#selectedList{
 margin-top:10px;
 padding-left:20px;
}

@media(max-width:600px){
 body{padding:12px}
}
</style>
</head>
<body>

<h2>Tournoi</h2>

<label>Tournament ID</label>
<input id="tournamentId" oninput="this.value=this.value.toUpperCase()">

<label>Phase</label>
<select id="phase">
<option value="RR">Round Robin</option>
<option value="SR">Swiss Round</option>
<option value="PhE">Phase Eliminatoire</option>
</select>

<label>Match</label>
<input id="matchNumber">

<label>Station</label>
<select id="station">
<option value="A">A</option>
<option value="B">B</option>
</select>

<button onclick="saveContext()">Valider contexte</button>

<hr>

<h2>Sélection des joueurs (3 max)</h2>

<div id="playerList"></div>

<p>Selection : <strong><span id="count">0</span>/3</strong></p>

<ul id="selectedList"></ul>

<button id="confirmBtn" disabled onclick="confirmTeam()">
Démarrer le match
</button>

<script>

let PLAYERS = JSON.parse(localStorage.getItem("players_registry")) || [
 {id:"P1",full_name:"Pablo Quenum",display_name:""},
 {id:"P2",full_name:"Leo Martin",display_name:""},
 {id:"P3",full_name:"Nico Durand",display_name:""},
 {id:"P4",full_name:"Sam Lopez",display_name:""},
 {id:"P5",full_name:"Tom Leroy",display_name:""}
];

let selected=[];

function getDisplayName(p){
 return p.display_name?.trim()?p.display_name:p.full_name;
}

function saveContext(){
 localStorage.setItem("tournament_id",
  document.getElementById("tournamentId").value);
 localStorage.setItem("phase",
  document.getElementById("phase").value);
 localStorage.setItem("match_number",
  document.getElementById("matchNumber").value);
 localStorage.setItem("station_id",
  document.getElementById("station").value);
}

function renderPlayers(){
 const container=document.getElementById("playerList");
 container.innerHTML="";
 PLAYERS.forEach(p=>{
  const btn=document.createElement("button");
  btn.textContent=getDisplayName(p);
  btn.onclick=()=>togglePlayer(p,btn);
  container.appendChild(btn);
 });
}

function togglePlayer(player,button){
 const index=selected.findIndex(p=>p.id===player.id);

 if(index>-1){
  selected.splice(index,1);
  button.classList.remove("selected");
 }else{
  if(selected.length>=3){
   alert("Maximum 3 joueurs");
   return;
  }
  selected.push(player);
  button.classList.add("selected");
 }

 updateUI();
}

function updateUI(){
 document.getElementById("count").textContent=selected.length;

 const list=document.getElementById("selectedList");
 list.innerHTML="";
 selected.forEach(p=>{
  const li=document.createElement("li");
  li.textContent=getDisplayName(p);
  list.appendChild(li);
 });

 document.getElementById("confirmBtn").disabled=selected.length!==3;
}

function confirmTeam(){
 localStorage.setItem("current_team",JSON.stringify(selected));
 window.location.href="match.html";
}

renderPlayers();

</script>
</body>
</html>

